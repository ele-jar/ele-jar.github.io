<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Media Hub</title>
    <style>
        :root {
            --primary-color-light: #5e35b1; --text-color-light: #1a1a1a; --bg-color-light: #f4f6f8; --card-bg-light: #ffffff; --border-color-light: #e0e0e0; --header-bg-light: rgba(255, 255, 255, 0.8);
            --primary-color-dark: #9575cd; --text-color-dark: #e0e0e0; --bg-color-dark: #121212; --card-bg-dark: #1e1e1e; --border-color-dark: #333; --header-bg-dark: rgba(30, 30, 30, 0.8);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        [data-theme="light"] {
            --primary-color: var(--primary-color-light); --text-color: var(--text-color-light); --bg-color: var(--bg-color-light);
            --card-bg: var(--card-bg-light); --border-color: var(--border-color-light); --header-bg: var(--header-bg-light);
        }
        [data-theme="dark"] {
            --primary-color: var(--primary-color-dark); --text-color: var(--text-color-dark); --bg-color: var(--bg-color-dark);
            --card-bg: var(--card-bg-dark); --border-color: var(--border-color-dark); --header-bg: var(--header-bg-dark);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: var(--bg-color); color: var(--text-color); transition: background-color 0.3s, color 0.3s; line-height: 1.6; }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        
        .header {
            position: sticky; top: 0; z-index: 100;
            background-color: var(--header-bg); backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);
            padding: 0 1.5rem; height: 70px; display: flex; align-items: center; justify-content: space-between;
            border-bottom: 1px solid var(--border-color);
        }
        .header-left { display: flex; align-items: center; gap: 1rem; }
        .logo { font-weight: 700; font-size: 1.5rem; color: var(--primary-color); }
        .hamburger-btn { display: none; background: none; border: none; cursor: pointer; padding: 0.5rem; }
        .hamburger-btn svg { stroke: var(--text-color); width: 28px; height: 28px; }
        
        .header-right { display: flex; align-items: center; gap: 1rem; }
        .search-bar { position: relative; }
        .search-bar input {
            background-color: var(--card-bg); border: 1px solid var(--border-color); border-radius: 20px;
            padding: 0.5rem 1rem 0.5rem 2.5rem; width: 250px; font-size: 1rem; color: var(--text-color);
        }
        .search-bar svg { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); fill: var(--text-color); opacity: 0.5; }
        .theme-switcher { cursor: pointer; background: none; border: none; padding: 0.5rem; }
        .theme-switcher svg { fill: var(--text-color); width: 24px; height: 24px; }
        
        .container { display: flex; }
        .sidebar {
            width: 260px; background-color: var(--bg-color); border-right: 1px solid var(--border-color);
            padding: 1.5rem; flex-shrink: 0; transition: transform 0.3s ease;
        }
        .sidebar nav a { display: flex; align-items: center; gap: 1rem; color: var(--text-color); text-decoration: none; padding: 0.8rem 1rem; margin-bottom: 0.5rem; font-weight: 500; border-radius: 8px; }
        .sidebar nav a:hover { background-color: var(--card-bg); }
        .sidebar nav a.active { background-color: var(--primary-color); color: white; }
        .sidebar nav a.active svg, .sidebar nav a:hover svg { fill: var(--primary-color); }
        .sidebar nav a.active svg { fill: white; }
        .sidebar nav a svg { fill: var(--text-color); width: 22px; height: 22px; }

        .main-content { padding: 2rem; width: 100%; }
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; }
        .video-card {
            background-color: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px;
            overflow: hidden; display: flex; flex-direction: column; box-shadow: var(--shadow); transition: transform 0.2s, box-shadow 0.2s;
        }
        .video-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.12); }
        .video-card-thumbnail { background-color: var(--primary-color); height: 150px; display: flex; align-items: center; justify-content: center; }
        .video-card-thumbnail svg { fill: white; width: 60px; height: 60px; }
        .video-card-info { padding: 1rem; flex-grow: 1; display: flex; flex-direction: column; }
        .video-card-info h3 { font-size: 1.1rem; font-weight: 500; margin-bottom: 0.5rem; word-break: break-all; }
        .video-card-info p { font-size: 0.9rem; opacity: 0.7; margin-bottom: 1rem; }
        .video-card-actions { display: flex; gap: 0.5rem; margin-top: auto; }
        .action-btn { flex-grow: 1; text-align: center; background-color: var(--primary-color); color: white; text-decoration: none; padding: 0.6rem; border-radius: 8px; font-weight: 500; transition: background-color 0.2s; font-size: 0.9rem; border: none; cursor: pointer; }
        .action-btn.secondary { background-color: var(--card-bg); color: var(--primary-color); border: 1px solid var(--primary-color); }
        
        .setup-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(10px); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .setup-box { background: var(--card-bg); padding: 2.5rem; border-radius: 12px; text-align: center; width: 90%; max-width: 400px; box-shadow: var(--shadow); }
        .setup-box h2 { margin-bottom: 1rem; } .setup-box p { margin-bottom: 1.5rem; opacity: 0.8; }
        .setup-box input { width: 100%; padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border-color); margin-bottom: 1rem; font-size: 1rem; background-color: var(--bg-color); color: var(--text-color); }
        .setup-box button { width: 100%; padding: 0.75rem; border: none; border-radius: 8px; background-color: var(--primary-color); color: white; font-size: 1rem; font-weight: 500; cursor: pointer; }
        .hidden { display: none; }
        
        @media (max-width: 768px) {
            .header-left { gap: 0.5rem; }
            .logo { display: none; }
            .search-bar { display: none; }
            .hamburger-btn { display: block; }
            .sidebar { position: fixed; height: 100%; z-index: 200; transform: translateX(-100%); background-color: var(--bg-color); }
            .sidebar.open { transform: translateX(0); box-shadow: 0 0 20px rgba(0,0,0,0.2); }
            .container { flex-direction: column; }
            .main-content { padding: 1.5rem 1rem; }
            .page-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 150; }
        }
    </style>
</head>
<body>

    <div class="setup-overlay" id="setupOverlay">
        <div class="setup-box">
            <h2>Welcome to Your Media Hub</h2>
            <p>Enter your VPS IP address to connect and load your library.</p>
            <input type="text" id="vpsIpInput" placeholder="e.g., 123.45.67.89">
            <button id="saveIpButton">Connect</button>
        </div>
    </div>
    <div class="loading-overlay hidden" id="loadingOverlay"></div>

    <header class="header">
        <div class="header-left">
            <button class="hamburger-btn" id="hamburgerBtn">
                <svg viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
            </button>
            <div class="logo">Media Hub</div>
        </div>
        <div class="header-right">
            <div class="search-bar">
                <svg viewBox="0 0 24 24" width="20" height="20"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
                <input type="text" id="searchInput" placeholder="Search videos...">
            </div>
            <button class="theme-switcher" id="themeSwitcher">
                <svg id="themeIcon" viewBox="0 0 24 24"><path d="M12,18C11.11,18 10.26,17.8 9.5,17.45C11.56,16.84 13.04,15.04 13.04,13C13.04,10.96 11.56,9.16 9.5,8.55C10.26,8.2 11.11,8 12,8C15.31,8 18,10.69 18,14C18,17.31 15.31,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" /></svg>
            </button>
        </div>
    </header>

    <div class="container">
        <aside class="sidebar" id="sidebar">
            <nav>
                <a href="#" class="active">
                    <svg viewBox="0 0 24 24"><path d="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M11,15V12H9V15H6V17H9V20H11V17H14V15H11Z" /></svg>
                    All Videos
                </a>
            </nav>
        </aside>
        <main class="main-content">
            <div id="videoGrid" class="video-grid"></div>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const themeSwitcher = document.getElementById('themeSwitcher');
        const setupOverlay = document.getElementById('setupOverlay');
        const saveIpButton = document.getElementById('saveIpButton');
        const vpsIpInput = document.getElementById('vpsIpInput');
        const videoGrid = document.getElementById('videoGrid');
        const searchInput = document.getElementById('searchInput');
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const sidebar = document.getElementById('sidebar');

        let allVideos = [];
        let vpsIp = localStorage.getItem('vpsIp');

        const applyTheme = (theme) => {
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        };

        const savedTheme = localStorage.getItem('theme') || 'dark';
        applyTheme(savedTheme);

        themeSwitcher.addEventListener('click', () => {
            const newTheme = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            applyTheme(newTheme);
        });

        const toggleSidebar = () => {
            sidebar.classList.toggle('open');
            const pageOverlay = document.querySelector('.page-overlay');
            if (sidebar.classList.contains('open') && !pageOverlay) {
                const overlay = document.createElement('div');
                overlay.className = 'page-overlay';
                document.body.appendChild(overlay);
                overlay.addEventListener('click', toggleSidebar);
            } else if (pageOverlay) {
                pageOverlay.remove();
            }
        };

        hamburgerBtn.addEventListener('click', toggleSidebar);

        const renderVideos = (videos) => {
            videoGrid.innerHTML = '';
            if (videos.length === 0) {
                videoGrid.innerHTML = '<p>No videos found matching your search.</p>';
                return;
            }
            videos.forEach(video => {
                const videoUrl = `http://${vpsIp}/Elevideos/${encodeURIComponent(video.title)}`;
                const card = document.createElement('div');
                card.className = 'video-card';
                card.innerHTML = `
                    <div class="video-card-thumbnail">
                        <svg viewBox="0 0 24 24"><path d="M10,16.5V7.5L16,12M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" /></svg>
                    </div>
                    <div class="video-card-info">
                        <h3>${video.title}</h3>
                        <p>Size: ${video.size}</p>
                        <div class="video-card-actions">
                            <a href="${videoUrl}" class="action-btn" download>Download</a>
                            <button class="action-btn secondary" data-url="${videoUrl}">Copy Link</button>
                        </div>
                    </div>
                `;
                videoGrid.appendChild(card);
            });
        };

        const fetchVideoList = async (ip) => {
            setupOverlay.classList.add('hidden');
            videoGrid.innerHTML = '<p>Loading library...</p>';
            try {
                const response = await fetch(`http://${ip}/Elevideos/videos.json?t=${new Date().getTime()}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                allVideos = data.videos;
                if (allVideos.length === 0) {
                    videoGrid.innerHTML = '<p>No videos found. Upload videos to `/root/Elevideos` and run the `generate_list.sh` script on your VPS.</p>';
                } else {
                    renderVideos(allVideos);
                }
            } catch (error) {
                videoGrid.innerHTML = `<p><strong>Error connecting to VPS.</strong><br>Please check the IP address and ensure Nginx and the list generator script are running correctly. <a href="#" id="resetIpLink">Reset IP Address</a></p>`;
                document.getElementById('resetIpLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    localStorage.removeItem('vpsIp');
                    window.location.reload();
                });
            }
        };

        if (vpsIp) {
            fetchVideoList(vpsIp);
        } else {
            setupOverlay.classList.remove('hidden');
        }

        saveIpButton.addEventListener('click', () => {
            const ip = vpsIpInput.value.trim();
            if (ip) {
                localStorage.setItem('vpsIp', ip);
                fetchVideoList(ip);
            } else {
                alert('Please enter a valid IP address.');
            }
        });
        
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredVideos = allVideos.filter(video => video.title.toLowerCase().includes(searchTerm));
            renderVideos(filteredVideos);
        });

        videoGrid.addEventListener('click', (e) => {
            if (e.target.matches('.action-btn.secondary')) {
                const url = e.target.dataset.url;
                navigator.clipboard.writeText(url).then(() => {
                    e.target.textContent = 'Copied!';
                    setTimeout(() => { e.target.textContent = 'Copy Link'; }, 2000);
                });
            }
        });
    });
    </script>
</body>
</html>
